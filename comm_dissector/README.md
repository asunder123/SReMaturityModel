# dji-firmware-tools communication dissector

Utility for analyzing communication in DJI drone interfaces via [Wireshark](https://www.wireshark.org/).

## Rationale

This is a [packet dissector](https://www.wireshark.org/docs/wsdg_html_chunked/ChapterDissection.html) which allows you
to view and analyze serial communication on interfaces within the DJI drones. It can also understand packets used
within binary Flight Record DAT files. There is also a KML export plugin for visualizing the flight.
The dissectors act as documentation on what is known about the DJI protocols, in form of simple LUA code.

## Setup

A simple setup is required to use the new dissector.

### Copy the script files

Copy all the files LUA files (```*.lua```) and to the Wireshark profile directory. If you already different ```init.lua``` there, merge the content.

#### Copying files in Linux

The directory usually is ```~/.config/wireshark```. If unsure, check [directories chapter in official documentation](https://www.wireshark.org/docs/wsug_html_chunked/ChAppFilesConfigurationSection.html).

#### Copying files in Windows

The directory usually is ```C:\Users\<username>\AppData\Roaming\Wireshark```.  Check [directories chapter in official documentation](https://www.wireshark.org/docs/wsug_html_chunked/ChAppFilesConfigurationSection.html)
and a special chapter for Windows folders if unsure.

### Associate comm_*2pcap output to new dissector

Now we need setup Wireshark to associate the pcap files generated by ```comm_*2pcap.py``` capture script with the ```dji_p3``` or ```dji_mavic``` protocol dissector. To do this:

* Start Wireshark

* Choose Edit | Preferences | Protocols

* Scroll down to DLT_USER

* Click Edit, create a new entry (‘+’) and set it up as shown below

![wireshark pref user dlt screenshot](img/wireshark-pref-user-dlt.png)

If you're using multiple USER dissectors, remember that you can set ```comm_*2pcap.py``` parameter to change the user slot while generating PCap file.

### Update columns in list of packets (optional)

You may also want to setup Wireshark’s main display columns:

* Choose Edit | Preferences | Columns

* Setup as shown below

![wireshark pref columns screenshot](img/wireshark-pref-columns.png)

Having your own column definitions will greatly increase readability of the packets list.
 
## Usage

After setup is complete, you can load pcap files and get results like this:

![wireshark using dji dissector screenshot](img/wireshark-using-dji-dissector.png)

You can now analyze DJI communication protocols.
